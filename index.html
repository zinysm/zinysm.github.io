<!DOCTYPE html>
<html lang="lt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renovacijos Master Planas - Ker≈≥ Kerai</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            min-height: 100vh;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 5px;
            color: #fff;
            font-size: 24px;
        }
        
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .tab {
            padding: 10px 25px;
            background: #252545;
            border: none;
            color: #aaa;
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .tab:hover {
            background: #353565;
        }
        
        .tab.active {
            background: #667eea;
            color: #fff;
        }
        
        .view {
            display: none;
        }
        
        .view.active {
            display: block;
        }
        
        /* Editor styles */
        .editor-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: #667eea;
            color: #fff;
        }
        
        .btn-primary:hover {
            background: #5a6fd6;
        }
        
        .btn-success {
            background: #27ae60;
            color: #fff;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: #fff;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #555;
            color: #fff;
        }
        
        .btn-secondary:hover {
            background: #666;
        }
        
        .start-date-input {
            padding: 8px 12px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #252545;
            color: #fff;
            font-size: 13px;
        }
        
        .editor-table-wrapper {
            overflow-x: auto;
            background: #252545;
            border-radius: 8px;
        }
        
        .editor-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        .editor-table th {
            background: #3a3a5a;
            padding: 12px 10px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #fff;
            position: sticky;
            top: 0;
        }
        
        .editor-table td {
            padding: 8px 10px;
            border-bottom: 1px solid #333;
            font-size: 13px;
        }
        
        .editor-table tr:hover {
            background: #2a2a4a;
        }
        
        .editor-table tr.dragging {
            opacity: 0.5;
            background: #667eea;
        }
        
        .editor-table tr.drag-over {
            border-top: 3px solid #667eea;
        }
        
        .drag-handle {
            cursor: grab;
            font-size: 18px;
            user-select: none;
            padding: 5px 10px;
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }
        
        .editor-table tr.section-row {
            background: #1a1a2e;
        }
        
        .editor-table tr.section-row td {
            padding: 10px;
            font-weight: 600;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }
        
        .editor-table input[type="text"],
        .editor-table input[type="number"],
        .editor-table input[type="date"] {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #1a1a2e;
            color: #fff;
            font-size: 13px;
        }
        
        .editor-table input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .editor-table select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #444;
            border-radius: 4px;
            background: #1a1a2e;
            color: #fff;
            font-size: 13px;
        }
        
        .editor-table .narrow {
            width: 80px;
        }
        
        .editor-table .medium {
            width: 120px;
        }
        
        .color-preview {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: inline-block;
            vertical-align: middle;
            margin-right: 5px;
        }
        
        .row-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-small {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        /* Gantt styles */
        .gantt-container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        
        .gantt-wrapper {
            background: #252545;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .gantt-scroll {
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .gantt {
            display: grid;
            min-width: 2800px;
            gap: 1px;
            background: #1a1a2e;
            grid-template-columns: 280px repeat(140, 18px);
        }
        
        .month-row, .day-row, .task-row {
            display: contents;
        }
        
        .month-cell {
            background: #3a3a5a;
            padding: 5px 4px;
            font-size: 10px;
            font-weight: 600;
            text-align: center;
            color: #fff;
        }
        
        .month-cell.task-col {
            text-align: left;
            padding-left: 12px;
        }
        
        .day-cell {
            background: #2a2a4a;
            padding: 3px 2px;
            font-size: 8px;
            text-align: center;
            color: #888;
        }
        
        .day-cell.task-col {
            background: #3a3a5a;
            font-size: 10px;
            font-weight: 600;
            color: #fff;
            text-align: left;
            padding-left: 12px;
        }
        
        .day-cell.weekend {
            background: #222240;
            color: #555;
        }
        
        .day-cell.today {
            background: #667eea;
            color: #fff;
            font-weight: bold;
        }
        
        .section-header {
            grid-column: 1 / -1;
            background: #1a1a2e;
            padding: 8px 12px;
            font-weight: 600;
            font-size: 12px;
            color: #667eea;
            border-left: 3px solid #667eea;
        }
        
        .section-header.critical {
            color: #ff6b6b;
            border-left-color: #ff6b6b;
        }
        
        .task-name {
            background: #252545;
            padding: 8px 12px;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-left: 3px solid #667eea;
        }
        
        .task-name.delivery { border-left-color: #27ae60; }
        .task-name.decision { border-left-color: #3498db; }
        .task-name.work { border-left-color: #9b59b6; }
        .task-name.critical { border-left-color: #e74c3c; background: #2d2040; }
        .task-name.warning { border-left-color: #f39c12; }
        .task-name.done { border-left-color: #1abc9c; }
        
        .task-title { font-weight: 500; }
        .task-dates { font-size: 9px; color: #888; margin-top: 2px; }
        .task-note { font-size: 9px; color: #ff6b6b; margin-top: 1px; }
        
        .day-slot {
            background: #252545;
            position: relative;
            min-height: 36px;
        }
        
        .day-slot.weekend { background: #222240; }
        
        .bar {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            height: 20px;
            border-radius: 2px;
            left: 0;
            right: 0;
        }
        
        .bar.delivery { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .bar.decision { background: linear-gradient(135deg, #3498db, #5dade2); }
        .bar.work { background: linear-gradient(135deg, #9b59b6, #a569bd); }
        .bar.critical { background: linear-gradient(135deg, #e74c3c, #ec7063); }
        .bar.warning { background: linear-gradient(135deg, #f39c12, #f7b731); }
        .bar.done { background: linear-gradient(135deg, #1abc9c, #48c9b0); }
        
        .bar.start { border-radius: 2px 0 0 2px; }
        .bar.end { border-radius: 0 2px 2px 0; }
        .bar.single { border-radius: 2px; }
        .bar.middle { border-radius: 0; }
        
        /* Summary cards */
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .summary-card {
            background: #252545;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        
        .summary-card .number {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        
        .summary-card .label {
            font-size: 10px;
            color: #888;
            margin-top: 4px;
        }
        
        .summary-card.warning .number { color: #f39c12; }
        .summary-card.critical .number { color: #e74c3c; }
        .summary-card.success .number { color: #27ae60; }
        
        /* Notes */
        .notes {
            margin-top: 25px;
            background: #252545;
            border-radius: 8px;
            padding: 15px;
        }
        
        .notes h2 {
            color: #ff6b6b;
            margin-bottom: 12px;
            font-size: 14px;
        }
        
        .notes-grid {
            display: grid;
            gap: 8px;
        }
        
        .note-item {
            padding: 10px 12px;
            background: #2d2545;
            border-radius: 5px;
            border-left: 3px solid #ff6b6b;
            font-size: 12px;
        }
        
        .note-item strong { color: #fff; }
        .note-item.info { border-left-color: #667eea; background: #252560; }
        .note-item.success { border-left-color: #27ae60; background: #253545; }
        
        /* Export modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #252545;
            padding: 25px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-content h3 {
            margin-bottom: 15px;
        }
        
        .modal-content textarea {
            width: 100%;
            height: 300px;
            background: #1a1a2e;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }
    </style>
</head>
<body>
    <h1>üè† Renovacijos Master Planas</h1>
    <p class="subtitle">Ker≈≥ Kerai 70m¬≤ ¬∑ Rangovas: Balsteta</p>
    
    <div class="tabs">
        <button class="tab active" onclick="switchTab('gantt')">üìä Gantt Grafikas</button>
        <button class="tab" onclick="switchTab('editor')">‚úèÔ∏è Redaguoti</button>
    </div>
    
    <!-- GANTT VIEW -->
    <div id="gantt-view" class="view active">
        <div class="gantt-container">
            <div class="summary" id="summary"></div>
            
            <div class="legend">
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #27ae60, #2ecc71);"></div><span>Pristatymai</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #3498db, #5dade2);"></div><span>Sprendimai</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #9b59b6, #a569bd);"></div><span>Darbai</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #ec7063);"></div><span>Kritinis</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f39c12, #f7b731);"></div><span>Dƒómesio</span></div>
                <div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #1abc9c, #48c9b0);"></div><span>Atlikta</span></div>
            </div>
            
            <div class="gantt-wrapper">
                <div class="gantt-scroll">
                    <div class="gantt" id="gantt"></div>
                </div>
            </div>
            
            <div class="notes">
                <h2>‚ö†Ô∏è Klausimai Balstetai</h2>
                <div class="notes-grid">
                    <div class="note-item"><strong>1. Nematomos durys:</strong> Kada pristatymas ir montavimas? PRIE≈† mikrocementƒÖ!</div>
                    <div class="note-item"><strong>2. Mikrocementas:</strong> Kada meistras? PO dur≈≥ montavimo!</div>
                    <div class="note-item"><strong>3. Parketas:</strong> Kada klojƒójai? Koordinuoti auk≈°ƒçius!</div>
                </div>
            </div>
            
            <div class="notes" style="margin-top: 15px;">
                <h2 style="color: #667eea;">üìã Priklausomybƒós</h2>
                <div class="notes-grid">
                    <div class="note-item info"><strong>Sienos:</strong> Gipskartonis ‚Üí Glaistymas ‚Üí Durys ‚Üí Mikrocementas ‚Üí Da≈æymas</div>
                    <div class="note-item info"><strong>Grindys:</strong> Auk≈°ƒçiai ≈æinoti iki 02-09</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- EDITOR VIEW -->
    <div id="editor-view" class="view">
        <div class="editor-container">
            <div class="toolbar">
                <label>Projekto prad≈æia: </label>
                <input type="date" id="startDate" class="start-date-input" value="2025-01-26" onchange="updateAll()">
                <button class="btn btn-success" onclick="addTask()">‚ûï Pridƒóti u≈æduotƒØ</button>
                <button class="btn btn-primary" onclick="addSection()">üìÅ Pridƒóti sekcijƒÖ</button>
                <button class="btn btn-secondary" onclick="exportData()">üíæ Eksportuoti</button>
                <button class="btn btn-secondary" onclick="importData()">üìÇ Importuoti</button>
            </div>
            
            <div class="editor-table-wrapper">
                <table class="editor-table">
                    <thead>
                        <tr>
                            <th style="width: 40px;"></th>
                            <th style="width: 250px;">U≈æduotis</th>
                            <th style="width: 100px;">Tipas</th>
                            <th style="width: 110px;">Prad≈æia</th>
                            <th style="width: 70px;">Trukmƒó (d)</th>
                            <th style="width: 110px;">Pabaiga</th>
                            <th>Pastaba</th>
                            <th style="width: 80px;">Veiksmai</th>
                        </tr>
                    </thead>
                    <tbody id="taskTable"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- EXPORT/IMPORT MODAL -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Eksportuoti duomenis</h3>
            <textarea id="modalData"></textarea>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">U≈ædaryti</button>
                <button class="btn btn-primary" id="modalAction" onclick="copyData()">Kopijuoti</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let projectStart = new Date(2025, 0, 26);
        let tasks = [
            { type: 'section', name: 'üì¶ PRISTATYMAI IR SPRENDIMAI' },
            { name: 'Potinkinƒó santechnika, WC rƒómas, trapas', category: 'delivery', startDay: 0, duration: 7, note: '' },
            { name: 'Parketo/plyteli≈≥ auk≈°ƒçiai - ≈æinoti', category: 'decision', startDay: 7, duration: 7, note: 'Kritinis terminas!' },
            { name: '≈†viestuv≈≥ laid≈≥ i≈°siki≈°imas', category: 'decision', startDay: 7, duration: 7, note: '' },
            { name: 'Signalizacija', category: 'delivery', startDay: 7, duration: 7, note: '' },
            { name: 'Plyteli≈≥ pristatymas', category: 'delivery', startDay: 14, duration: 14, note: '3-4 sav' },
            { name: 'Spalv≈≥ pasirinkimas (da≈æai)', category: 'decision', startDay: 42, duration: 7, note: '7 sav' },
            { name: 'Rozetƒós, jungikliai, ≈°viestuvai, santechnika', category: 'delivery', startDay: 56, duration: 7, note: '9 sav' },
            { name: 'Difuzoriai (Ventman) - pristatyti', category: 'delivery', startDay: 14, duration: 7, note: 'Prie≈° gipskartonƒØ' },
            
            { type: 'section', name: '‚ö†Ô∏è KRITINIAI - I≈†SIAI≈†KINTI SU BALSTETA', critical: true },
            { name: 'Nematomos durys (1vnt vonia‚Üîpagalbinƒó)', category: 'critical', startDay: 28, duration: 14, note: '‚ùì PRIE≈† mikrocementƒÖ!' },
            { name: 'Mikrocementas (sienos + stakta)', category: 'critical', startDay: 42, duration: 10, note: '‚ùì PO dur≈≥ montavimo!' },
            { name: 'Parketo klojimas', category: 'warning', startDay: 56, duration: 10, note: '‚ùì Klausti Balstetos kada' },
            
            { type: 'section', name: '‚è∞ U≈ΩSAKYTI LAIKU (nepamesti!)' },
            { name: 'Spintos - susirasti gamintojƒÖ', category: 'warning', startDay: 14, duration: 14, note: 'Ie≈°koti DABAR' },
            { name: 'Spintos - galutinis matavimas', category: 'decision', startDay: 42, duration: 3, note: 'Kai sienos baigtos' },
            { name: 'Vonios baldas - i≈°sirinkti ir u≈æsakyti', category: 'warning', startDay: 21, duration: 21, note: 'Reikia prie≈° kriauklƒô!' },
            { name: 'Veidrod≈æiai - i≈°sirinkti', category: 'decision', startDay: 49, duration: 14, note: 'Laidas jau i≈°vestas' },
            
            { type: 'section', name: 'üî® DARBAI - PARUO≈†IMAS' },
            { name: 'Griovimo darbai', category: 'work', startDay: 0, duration: 7, note: '' },
            { name: 'Elektros instaliacija', category: 'work', startDay: 7, duration: 14, note: '' },
            { name: 'Santechnikos instaliacija', category: 'work', startDay: 7, duration: 14, note: '' },
            { name: 'Ventiliacijos montavimas (Vallox 099 + difuzoriai)', category: 'work', startDay: 14, duration: 10, note: '' },
            { name: 'Gipskartonio darbai', category: 'work', startDay: 21, duration: 14, note: '' },
            { name: 'Grind≈≥ ≈°ildymo instaliacija', category: 'work', startDay: 28, duration: 10, note: '' },
            
            { type: 'section', name: 'üî® DARBAI - APDAILA' },
            { name: 'Glaistymas', category: 'work', startDay: 35, duration: 10, note: '' },
            { name: 'Da≈æymas', category: 'work', startDay: 52, duration: 10, note: 'Po mikrocemento' },
            { name: 'Plytelƒós - vonia', category: 'work', startDay: 56, duration: 7, note: '' },
            { name: 'Plytelƒós - pagalbinƒó patalpa', category: 'work', startDay: 63, duration: 4, note: '' },
            { name: 'Plytelƒós - virtuvƒó/prie≈°kambaris', category: 'work', startDay: 67, duration: 5, note: '' },
            
            { type: 'section', name: 'üî® DARBAI - MONTAVIMAS' },
            { name: 'Paprastos durys - montavimas', category: 'work', startDay: 70, duration: 3, note: 'Po da≈æymo, prie≈° grindjuostes' },
            { name: 'Vonios baldas - montavimas', category: 'work', startDay: 70, duration: 2, note: '' },
            { name: 'Santechnikos apdaila (kriauklƒó, WC, du≈°as)', category: 'work', startDay: 72, duration: 5, note: 'Hansgrohe' },
            { name: 'Elektros apdaila (rozetƒós, jungikliai, ≈°viestuvai)', category: 'work', startDay: 72, duration: 5, note: '' },
            { name: 'Spintos - montavimas', category: 'work', startDay: 77, duration: 5, note: '~4-6 sav po matavimo' },
            { name: 'Veidrod≈æiai - montavimas', category: 'work', startDay: 77, duration: 2, note: '' },
            { name: 'Grindjuostƒós', category: 'work', startDay: 82, duration: 3, note: 'Po spint≈≥!' },
            { name: 'Skalbimo ma≈°inos prijungimas', category: 'work', startDay: 77, duration: 1, note: 'Pagalbinƒó patalpa' },
            { name: 'Baigiamieji darbai, valymas', category: 'work', startDay: 85, duration: 7, note: '' },
            
            { type: 'section', name: '‚úÖ JAU U≈ΩSAKYTA / NUPIRKTA' },
            { name: 'Vallox 099 entalpinis rekuperatorius', category: 'done', startDay: 0, duration: 1, note: '' },
            { name: 'Difuzoriai (Ventman)', category: 'done', startDay: 0, duration: 1, note: '' },
            { name: 'Alice Ceramica vonios keramika', category: 'done', startDay: 0, duration: 1, note: '' },
            { name: 'Hansgrohe mai≈°ytuvai', category: 'done', startDay: 0, duration: 1, note: '' },
            
            { type: 'section', name: '‚è∏Ô∏è 2 ETAPAS (vƒóliau)' },
            { name: 'Virtuvƒós baldai - matavimas', category: 'decision', startDay: 92, duration: 1, note: 'Kai bus pinig≈≥' },
            { name: 'Virtuvƒós baldai - gamyba', category: 'delivery', startDay: 93, duration: 30, note: '~4-6 sav' },
            { name: 'Virtuvƒós baldai - montavimas', category: 'work', startDay: 123, duration: 3, note: '' },
            { name: 'Buitinƒó technika', category: 'delivery', startDay: 123, duration: 3, note: 'Orkaitƒó, kaitlentƒó, indaplovƒó' },
        ];
        
        const categories = {
            delivery: { name: 'Pristatymas', color: '#27ae60' },
            decision: { name: 'Sprendimas', color: '#3498db' },
            work: { name: 'Darbai', color: '#9b59b6' },
            critical: { name: 'Kritinis', color: '#e74c3c' },
            warning: { name: 'Dƒómesio', color: '#f39c12' },
            done: { name: 'Atlikta', color: '#1abc9c' }
        };
        
        // Utility functions
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }
        
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
        
        function daysBetween(date1, date2) {
            return Math.round((date2 - date1) / (1000 * 60 * 60 * 24));
        }
        
        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6;
        }
        
        function getMonthName(date) {
            return date.toLocaleDateString('lt-LT', { month: 'short', year: 'numeric' });
        }
        
        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-view`).classList.add('active');
            
            if (tab === 'gantt') renderGantt();
        }
        
        // Editor functions
        function renderEditor() {
            const tbody = document.getElementById('taskTable');
            tbody.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const tr = document.createElement('tr');
                tr.draggable = true;
                tr.dataset.index = index;
                
                // Drag events
                tr.addEventListener('dragstart', (e) => {
                    tr.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', index);
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                tr.addEventListener('dragend', () => {
                    tr.classList.remove('dragging');
                    document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                });
                
                tr.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    tr.classList.add('drag-over');
                });
                
                tr.addEventListener('dragleave', () => {
                    tr.classList.remove('drag-over');
                });
                
                tr.addEventListener('drop', (e) => {
                    e.preventDefault();
                    tr.classList.remove('drag-over');
                    const fromIndex = parseInt(e.dataTransfer.getData('text/plain'));
                    const toIndex = index;
                    if (fromIndex !== toIndex) {
                        const item = tasks.splice(fromIndex, 1)[0];
                        tasks.splice(toIndex, 0, item);
                        saveToStorage();
                        renderEditor();
                    }
                });
                
                if (task.type === 'section') {
                    tr.className = 'section-row';
                    tr.innerHTML = `
                        <td class="drag-handle">‚ò∞</td>
                        <td colspan="5">
                            <input type="text" value="${task.name}" onchange="updateTask(${index}, 'name', this.value)">
                        </td>
                        <td></td>
                        <td>
                            <div class="row-actions">
                                <button class="btn btn-danger btn-small" onclick="deleteTask(${index})">üóëÔ∏è</button>
                            </div>
                        </td>
                    `;
                } else {
                    const startDate = addDays(projectStart, task.startDay);
                    const endDate = addDays(projectStart, task.startDay + task.duration);
                    
                    tr.innerHTML = `
                        <td class="drag-handle">‚ò∞</td>
                        <td><input type="text" value="${task.name}" onchange="updateTask(${index}, 'name', this.value)"></td>
                        <td>
                            <select onchange="updateTask(${index}, 'category', this.value)">
                                ${Object.entries(categories).map(([key, val]) => 
                                    `<option value="${key}" ${task.category === key ? 'selected' : ''}>${val.name}</option>`
                                ).join('')}
                            </select>
                        </td>
                        <td><input type="date" value="${formatDate(startDate)}" onchange="updateTaskDate(${index}, this.value)"></td>
                        <td><input type="number" value="${task.duration}" min="1" class="narrow" onchange="updateTask(${index}, 'duration', parseInt(this.value))"></td>
                        <td style="color: #888;">${formatDate(endDate)}</td>
                        <td><input type="text" value="${task.note || ''}" onchange="updateTask(${index}, 'note', this.value)" placeholder="Pastaba..."></td>
                        <td>
                            <div class="row-actions">
                                <button class="btn btn-danger btn-small" onclick="deleteTask(${index})">üóëÔ∏è</button>
                            </div>
                        </td>
                    `;
                }
                
                tbody.appendChild(tr);
            });
        }
        
        function updateTask(index, field, value) {
            tasks[index][field] = value;
            saveToStorage();
            renderEditor();
        }
        
        function updateTaskDate(index, dateStr) {
            const newDate = new Date(dateStr);
            tasks[index].startDay = daysBetween(projectStart, newDate);
            saveToStorage();
            renderEditor();
        }
        
        function addTask() {
            tasks.push({
                name: 'Nauja u≈æduotis',
                category: 'work',
                startDay: 0,
                duration: 7,
                note: ''
            });
            saveToStorage();
            renderEditor();
        }
        
        function addSection() {
            tasks.push({
                type: 'section',
                name: 'üìÅ Nauja sekcija'
            });
            saveToStorage();
            renderEditor();
        }
        
        function deleteTask(index) {
            if (confirm('I≈°trinti ≈°iƒÖ eilutƒô?')) {
                tasks.splice(index, 1);
                saveToStorage();
                renderEditor();
            }
        }
        
        // Gantt rendering
        function renderGantt() {
            const gantt = document.getElementById('gantt');
            const totalDays = 140;
            const today = new Date();
            
            let html = '';
            
            // Month row
            html += '<div class="month-row"><div class="month-cell task-col">U≈æduotis</div>';
            let months = [];
            let currentMonth = null;
            let count = 0;
            
            for (let i = 0; i < totalDays; i++) {
                const date = addDays(projectStart, i);
                const monthName = getMonthName(date);
                if (monthName !== currentMonth) {
                    if (currentMonth !== null) months.push({ name: currentMonth, span: count });
                    currentMonth = monthName;
                    count = 1;
                } else {
                    count++;
                }
            }
            months.push({ name: currentMonth, span: count });
            
            for (const month of months) {
                html += `<div class="month-cell" style="grid-column: span ${month.span}">${month.name}</div>`;
            }
            html += '</div>';
            
            // Day row
            html += '<div class="day-row"><div class="day-cell task-col">Prad≈æia ‚Üí Pabaiga</div>';
            for (let i = 0; i < totalDays; i++) {
                const date = addDays(projectStart, i);
                const dayNum = date.getDate();
                const weekend = isWeekend(date) ? ' weekend' : '';
                const isToday = date.toDateString() === today.toDateString() ? ' today' : '';
                html += `<div class="day-cell${weekend}${isToday}">${dayNum}</div>`;
            }
            html += '</div>';
            
            // Task rows
            for (const task of tasks) {
                if (task.type === 'section') {
                    const critical = task.critical ? ' critical' : '';
                    html += `<div class="section-header${critical}">${task.name}</div>`;
                    continue;
                }
                
                const startDate = addDays(projectStart, task.startDay);
                const endDate = addDays(projectStart, task.startDay + task.duration);
                const dateStr = `${formatDate(startDate)} ‚Üí ${formatDate(endDate)}`;
                
                html += '<div class="task-row">';
                html += `<div class="task-name ${task.category}">
                    <div class="task-title">${task.name}</div>
                    <div class="task-dates">${dateStr}</div>
                    ${task.note ? `<div class="task-note">${task.note}</div>` : ''}
                </div>`;
                
                for (let i = 0; i < totalDays; i++) {
                    const date = addDays(projectStart, i);
                    const weekend = isWeekend(date) ? ' weekend' : '';
                    const inRange = i >= task.startDay && i < task.startDay + task.duration;
                    
                    if (inRange) {
                        let barClass = task.category;
                        if (task.duration === 1) barClass += ' single';
                        else if (i === task.startDay) barClass += ' start';
                        else if (i === task.startDay + task.duration - 1) barClass += ' end';
                        else barClass += ' middle';
                        html += `<div class="day-slot"><div class="bar ${barClass}"></div></div>`;
                    } else {
                        html += `<div class="day-slot${weekend}"></div>`;
                    }
                }
                html += '</div>';
            }
            
            gantt.innerHTML = html;
            
            // Update summary
            updateSummary();
        }
        
        function updateSummary() {
            const realTasks = tasks.filter(t => !t.type);
            const maxEnd = Math.max(...realTasks.map(t => t.startDay + t.duration));
            const endDate = addDays(projectStart, maxEnd);
            const criticalCount = realTasks.filter(t => t.category === 'critical' || t.category === 'warning').length;
            const doneCount = realTasks.filter(t => t.category === 'done').length;
            
            document.getElementById('summary').innerHTML = `
                <div class="summary-card">
                    <div class="number">${formatDate(projectStart).slice(5)}</div>
                    <div class="label">Prad≈æia</div>
                </div>
                <div class="summary-card">
                    <div class="number">${maxEnd} d.</div>
                    <div class="label">Trukmƒó</div>
                </div>
                <div class="summary-card">
                    <div class="number">${formatDate(endDate).slice(5)}</div>
                    <div class="label">Pabaiga</div>
                </div>
                <div class="summary-card critical">
                    <div class="number">${criticalCount}</div>
                    <div class="label">Kritiniai</div>
                </div>
                <div class="summary-card success">
                    <div class="number">${doneCount}</div>
                    <div class="label">U≈æsakyta</div>
                </div>
            `;
        }
        
        function updateAll() {
            const dateInput = document.getElementById('startDate');
            projectStart = new Date(dateInput.value);
            saveToStorage();
            renderEditor();
        }
        
        // Export/Import
        function exportData() {
            const data = {
                projectStart: formatDate(projectStart),
                tasks: tasks
            };
            document.getElementById('modalTitle').textContent = 'Eksportuoti duomenis';
            document.getElementById('modalData').value = JSON.stringify(data, null, 2);
            document.getElementById('modalAction').textContent = 'Kopijuoti';
            document.getElementById('modalAction').onclick = copyData;
            document.getElementById('modal').classList.add('active');
        }
        
        function importData() {
            document.getElementById('modalTitle').textContent = 'Importuoti duomenis';
            document.getElementById('modalData').value = '';
            document.getElementById('modalAction').textContent = 'Importuoti';
            document.getElementById('modalAction').onclick = doImport;
            document.getElementById('modal').classList.add('active');
        }
        
        function copyData() {
            const textarea = document.getElementById('modalData');
            textarea.select();
            document.execCommand('copy');
            alert('Nukopijuota!');
        }
        
        function doImport() {
            try {
                const data = JSON.parse(document.getElementById('modalData').value);
                if (data.projectStart) {
                    projectStart = new Date(data.projectStart);
                    document.getElementById('startDate').value = data.projectStart;
                }
                if (data.tasks) {
                    tasks = data.tasks;
                }
                saveToStorage();
                renderEditor();
                closeModal();
                alert('Importuota sƒókmingai!');
            } catch (e) {
                alert('Klaida: neteisingas formatas');
            }
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        // Local storage
        function saveToStorage() {
            const data = {
                projectStart: formatDate(projectStart),
                tasks: tasks
            };
            localStorage.setItem('renovacija_planas', JSON.stringify(data));
        }
        
        function loadFromStorage() {
            const saved = localStorage.getItem('renovacija_planas');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.projectStart) {
                        projectStart = new Date(data.projectStart);
                        document.getElementById('startDate').value = data.projectStart;
                    }
                    if (data.tasks) {
                        tasks = data.tasks;
                    }
                } catch (e) {
                    console.error('Failed to load saved data');
                }
            }
        }
        
        // Initialize
        loadFromStorage();
        renderEditor();
        renderGantt();
    </script>
</body>
</html>
